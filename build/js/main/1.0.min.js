!function(e,t,n){"use strict";var a=t.watch,i=t.q,o=t.Eventer,c=t.show,s=t.hide,r=t.on,u=t.find,l=t.findIndex,d=t.remove,f=t.assign,m=config.account,p={client:n.connect(),eventer:new o,mask:{el:i("#mask")},exec:function(e,t){this.eventer.emit(e,t)},funcs:{getUserInfo:function(e){p.client.emit("getUserInfo",{account:e})},getBlacklistMemberInfo:function(e){return u(data.blacklistMembersInfo,function(t){return t.account===e})},getGroupMembersInfo:function(e){var t=p.funcs.findGroup(e),n=[];return t.members.forEach(function(e){n.push(data.groupsMembersInfo[e])}),n},getTeamMembersInfo:function(e){var t=p.funcs.findTeam(e),n=[];return t.members.forEach(function(e){n.push(data.groupsMembersInfo[e])}),n},getMemberInfo:function(e){return data.groupsMembersInfo[e]},getCloudMsg:function(e){p.client.emit("getCloudMsg",e)},findGroupUser:function(t){return e.data.groupsMembersInfo[t]},find:function(t){var n,a=t.type;return n="p2p"===a?"friends":"group"===a?"groups":"session"===a?"sessions":"teams",u(e.data[n],function(e){return e.account===t.account})||null},findFriend:function(e){return p.funcs.find({type:"p2p",account:e})},findGroup:function(e){return p.funcs.find({type:"group",account:e})},findTeam:function(e){return p.funcs.find({type:"team",account:e})},findSession:function(e){return p.funcs.find({type:"session",account:e})},addGroupMember:function(e,t){p.client.emit("addGroupMember",{account:e,members:t})},removeGroupMember:function(e,t){p.client.emit("removeGroupMember",{account:e,members:t})},addTeamMember:function(e,t){p.client.emit("addTeamMember",{account:e,members:t})},removeTeamMember:function(e,t){p.client.emit("removeTeamMember",{account:e,members:t})},createGroup:function(e,t){p.client.emit("createGroup",{owner:e,members:t})},existGroup:function(e){p.client.emit("existGroup",{account:e,target:data.account})},existTeam:function(e){p.client.emit("existTeam",{account:e,target:data.account})},dissolveGroup:function(e){p.client.emit("dissolveGroup",{account:e})},createTeam:function(e,t){p.client.emit("createTeam",{owner:e,members:t})},addFriend:function(e){p.client.emit("addFriend",{account:m,target:e})},deleteFriend:function(e){p.client.emit("deleteFriend",{account:m,target:e})},isBlacklist:function(e){return-1!==l(data.blacklist,function(t){return t.account===e})},addBlacklist:function(e){p.client.emit("addBlacklist",{account:m,target:e})},removeBlacklist:function(e){p.client.emit("removeBlacklist",{account:m,target:e})},updateNoteName:function(e,t,n){p.client.emit("updateNoteName",{owner:e,target:t,noteName:n})},updateUserInfo:function(e){p.client.emit("updateUserInfo",e)},updateGroupName:function(e){p.client.emit("updateGroupName",e)},updateTeamName:function(e){p.client.emit("updateTeamName",e)},updateGroupDes:function(e){p.client.emit("updateGroupDes",e)},updateAuthentication:function(e){p.client.emit("updateAuthentication",e)},updateInvitePermissions:function(e){p.client.emit("updateInvitePermissions",e)},updateModifyPermissions:function(e){p.client.emit("updateModifyPermissions",e)},updateBeAuthentication:function(e){p.client.emit("updateBeAuthentication",e)},sendMsg:function(e){p.client.emit("msg",e)}},initClient:function(n){var a=this;n.on("init",function(t){e.data=t,a.exec("init")}),n.on("refreshCloudMsg",function(e){var t=null===e?[]:e.messages.map(function(t){return t.type=t.type||e.type,t});a.exec("cloudMsg-refresh",t)}),n.on("updateGroupsMembersInfo",function(e){t.assign(data.groupsMembersInfo,e),a.exec("groupInfo-update")}),n.on("searchGroupResult",function(e){a.exec("groupDialog-refresh",e)}),n.on("searchUserResult",function(e){a.exec("userDialog-refresh",e)}),n.on("addGroup",function(e){data.groups.push(e)}),n.on("addTeam",function(e){data.teams.push(e)}),n.on("addGroupMember",function(e){var t=a.funcs.findGroup(e.account);null!==t&&e.members.forEach(function(e){t.members.push(e)})}),n.on("addTeamMember",function(e){var t=a.funcs.findTeam(e.account);null!==t&&e.members.forEach(function(e){t.members.push(e)})}),n.on("removeGroupMember",function(e){var t=a.funcs.findGroup(e.account);null!==t&&e.members.forEach(function(e){t.members.remove(e)})}),n.on("removeTeamMember",function(e){var t=a.funcs.findTeam(e.account);null!==t&&e.members.forEach(function(e){t.members.remove(e)})}),n.on("removeGroup",function(e){data.groups.remove(e.account),a.exec("groupInfo-onRemoveGroup",e),a.exec("chatWindow-onRemoveGroup",e),a.exec("chatPanel-updateGroup",e)}),n.on("removeTeam",function(e){data.teams.remove(e.account),a.exec("groupInfo-onRemoveGroup",e),a.exec("chatWindow-onRemoveGroup",e),a.exec("chatPanel-updateGroup",e)}),n.on("addFriend",function(e){data.friends.push(e)}),n.on("deleteFriend",function(e){data.friends.remove(e.target)}),n.on("addBlacklist",function(e){data.blacklistMembersInfo.push(p.funcs.findFriend(e.account)||p.funcs.findGroupUser(e.account)),data.blacklist.push(e)}),n.on("removeBlacklist",function(e){d(data.blacklistMembersInfo,function(t){return t.account===e.account}),data.blacklist.remove(e.account)}),n.on("refreshOthersInfo",function(e){a.exec("othersInfo-refresh",e)}),n.on("updateUserInfo",function(e){f(data,e),a.exec("chatPanel-refreshNickName")}),n.on("updateNoteName",function(e){u(data.friends,function(t){return t.account===e.target}).noteName=e.noteName,alert("修改备注名成功!"),a.exec("chatPanel-updateNoteName",e),a.exec("othersInfo-refreshNoteName")}),n.on("updateGroupName",function(e){a.funcs.findGroup(e.account).name=e.value,a.exec("chatPanel-updateGroupName",e)}),n.on("updateTeamName",function(e){a.funcs.findTeam(e.account).name=e.value,a.exec("chatPanel-updateTeamName",e)}),n.on("updateGroupDes",function(e){a.funcs.findGroup(e.account).des=e.value}),n.on("updateAuthentication",function(e){a.funcs.findGroup(e.account).permissions.verify=e.value}),n.on("updateInvitePermissions",function(e){a.funcs.findGroup(e.account).permissions.invite=e.value}),n.on("updateModifyPermissions",function(e){a.funcs.findGroup(e.account).permissions.modify=e.value}),n.on("updateBeAuthentication",function(e){a.funcs.findGroup(e.account).permissions.verifyed=e.value}),n.on("msg",function(e){a.exec("chatPanel-updateSession",e)})},init:function(){a(p.mask,"show","boolean",!1,function(e){e?c(p.mask.el):s(p.mask.el)}),this.initClient(this.client),this.funcs.getUserInfo(m)}};p.eventer.on("loaded",function(){"function"==typeof p.init&&(p.init(),p.init=null)}),r(window,"load",function(){p.exec("loaded")}),e.app=p}(this,utils,io),function(e,t,n){"use strict";var a=n.mask,i=utils.show,o=utils.hide,c=utils.q,s=new V({el:"#blacklist",eles:{list:".list 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(s.el):o(s.el)}},list:{type:"array",init:[],extend:{push:function(e){var t=n.funcs.getBlacklistMemberInfo(e.account);s.eles.list.insertAdjacentHTML("beforeEnd",s.render(s.template.item,{name:e.noteName||t.nickName,account:e.account,avatar:t.avatar||data.defaultAvatar})),Array.prototype.push.call(this,e)},remove:function(e){var t=c.call(s.eles.list,"[data-account="+e+"]")[0];s.eles.list.removeChild(t);var n=utils.findIndex(s.list,e);Array.prototype.splice.call(s.list,n,1)}},callback:function(e){var t=[];e.forEach(function(e){var a=n.funcs.getBlacklistMemberInfo(e.account),i={name:e.noteName||a.nickName,account:e.account,avatar:a.avatar||data.defaultAvatar};t.push(s.render(s.template.item,i))}),s.eles.list.innerHTML=t.join("")}}},template:{item:c("#blacklist-item-template").innerHTML},funcs:{hide:function(){a.show=s.show=!1},show:function(){a.show=s.show=!0},add:function(e){n.funcs.addBlacklist(e)},remove:function(e){n.funcs.removeBlacklist(e)},removeUser:function(){var e=this.parentNode.getAttribute("data-account");s.funcs.remove(e)}},eventsMap:{"click .close":"hide","click .btn-ok":"removeUser"},api:{"blacklist-show":"show","blacklist-hide":"hide","blacklist-add":"add","blacklist-remove":"remove"},eventer:n.eventer,init:function(){s.list=data.blacklist}});n.eventer.on("init",function(){"function"==typeof s.init&&s.init()})}(0,utils,app),function(e,t,n){"use strict";var a,i=utils.show,o=utils.hide,c=utils.q,s=utils.serializeTime,r=utils.remove,u=utils.find,l=new V({el:"#chat-panel",eles:{header:".header 0",navs:".nav-tab",panels:".panel-item",sessions:"#sessions",friends:"#friends",groups:"#groups",teams:"#teams",items:".item"},data:{nav:{type:"string",init:"group-wrapper",callback:function(e){[].forEach.call(l.eles.navs,function(t){t.className=t.getAttribute("data-nav")===e?"nav-tab tc active":"nav-tab tc"}),[].forEach.call(l.eles.panels,function(t){t.id===e?i(t):o(t)})}},friends:{type:"array",init:[],extend:{push:function(e){var t=l.render(l.template.friendItem,{account:e.account,name:e.noteName||e.nickName,avatar:e.avatar||a.defaultAvatar});l.eles.friends.insertAdjacentHTML("beforeEnd",t),Array.prototype.push.call(this,e)},remove:function(e){var t=c.call(l.eles.friends,"[data-account="+e+"]")[0];t instanceof Element&&l.eles.friends.removeChild(t),r(this,function(t){return t.account===e})}},callback:function(e){var t="";e.forEach(function(e){t+=l.render(l.template.friendItem,{account:e.account,name:e.noteName||e.nickName,avatar:e.avatar||a.defaultAvatar})}),l.eles.friends.innerHTML=t}},groups:{type:"array",init:[],extend:{push:function(e){var t=l.render(l.template.groupItem,{account:e.account,type:"group",avatar:e.avatar||a.defaultGroupAvatar,name:e.name||null});l.eles.groups.insertAdjacentHTML("beforeEnd",t),Array.prototype.push.call(this,e)},remove:function(e){var t=c.call(l.eles.groups,'[data-account="'+e+'"]')[0];t instanceof Element&&l.eles.groups.removeChild(t),r(this,function(t){return t.account===e})}},callback:function(e){var t="";e.forEach(function(e){t+=l.render(l.template.groupItem,{account:e.account,type:"group",avatar:e.avatar||a.defaultGroupAvatar,name:e.name||null})}),t&&(t='<p class="item-title">高级群</p>'+t,l.eles.groups.innerHTML=t)}},teams:{type:"array",init:[],extend:{push:function(e){var t=l.render(l.template.teamItem,{account:e.account,type:"team",avatar:e.avatar||a.defaultTeamAvatar,name:e.name||null});l.eles.teams.insertAdjacentHTML("beforeEnd",t),Array.prototype.push.call(this,e)},remove:function(e){var t=c.call(l.eles.teams,'[data-account="'+e+'"]')[0];t instanceof Element&&l.eles.teams.removeChild(t),r(this,function(t){return t.account===e})}},callback:function(e){var t="";e.forEach(function(e){t+=l.render(l.template.groupItem,{account:e.account,type:"team",avatar:e.avatar||a.defaultTeamAvatar,name:e.name||null})}),t&&(t='<p class="item-title">讨论组</p>'+t,l.eles.teams.innerHTML=t)}},sessions:{type:"array",init:[],extend:{push:function(e){var t,i={};"p2p"===e.type?(t=n.funcs.findFriend(e.account)||n.funcs.findGroupUser(e.account),i.name=t.noteName||t.nickName,i.avatar=t.avatar||a.defaultAvatar):(t=n.funcs.findGroup(e.account))?(i.name=t.name,i.avatar=t.avatar||a.defaultGroupAvatar):(t=n.funcs.findTeam(e.account))?(i.name=t.name,i.avatar=t.avatar||a.defaultTeamAvatar,i.type="team"):(i.name=e.account,i.avatar=a.defaultTeamAvatar),i.type=i.type||e.type,i.account=e.account,i.updateTime=s(e.updateTime),i.lastMessage=e.messages[e.messages.length-1].content,i.unRead=e.unRead,l.eles.sessions.insertAdjacentHTML("afterBegin",l.render(l.template.sessionItem,i)),Array.prototype.push.call(this,e)}},callback:function(e){var t,i=[];e.forEach(function(e){var o={};"p2p"===e.type?(t=n.funcs.findFriend(e.account)||n.funcs.findGroupUser(e.account),o.name=t.noteName||t.nickName,o.avatar=t.avatar||a.defaultAvatar):(t=n.funcs.findGroup(e.account))?(o.name=t.name,o.avatar=t.avatar||a.defaultGroupAvatar):(t=n.funcs.findTeam(e.account))?(o.name=t.name,o.avatar=t.avatar||a.defaultTeamAvatar,o.type="team"):(o.name=e.account,o.avatar=a.defaultTeamAvatar),o.type=o.type||e.type,o.account=t.account,o.updateTime=s(e.updateTime),o.lastMessage=e.messages[e.messages.length-1].content,o.unRead=e.unRead,i.push(l.render(l.template.sessionItem,o))}),l.eles.sessions.innerHTML=i.join("")}}},template:{header:c("#chat-panel-header-template").innerHTML,sessionItem:c("#chat-panel-session-item-template").innerHTML,friendItem:c("#chat-panel-friend-item-template").innerHTML,groupItem:c("#chat-panel-group-item-template").innerHTML,teamItem:c("#chat-panel-team-item-template").innerHTML},funcs:{switchTab:function(){l.nav=this.getAttribute("data-nav")},showMyInfo:function(){l.exec("myInfo-show")},showBlacklist:function(){l.exec("blacklist-show")},showUserDialog:function(){l.exec("userDialog-show")},showGroupDialog:function(){l.exec("groupDialog-show")},showNotice:function(){l.exec("notice-show")},showOthersInfo:function(e){l.exec("othersInfo-show",e)},showLogoutDialog:function(){l.exec("logoutDialog-show")},createGroup:function(){l.exec("createGroup-show",{operate:"create",type:"group"})},createTeam:function(){l.exec("createGroup-show",{operate:"create",type:"team"})},showChatWindow:function(e){l.exec("chatWindow-show",e)},clickItem:function(e){var t=e.target||e.srcElement,n=this.getAttribute("data-type");if("IMG"===t.tagName&&"p2p"===n)return l.funcs.showOthersInfo({account:this.getAttribute("data-account")});if(n){var a=this.getAttribute("data-account");l.funcs.showChatWindow({type:n,account:"p2p"===n?a:parseInt(a)}),[].forEach.call(l.eles.items,function(e){utils.removeClass(e,"active")}),utils.addClass(this,"active");var i=c.call(l.eles.sessions,'[data-account="'+a+'"]')[0];i&&(c.call(i,".item-count")[0].innerHTML="")}},renderHeader:function(){l.eles.header.insertAdjacentHTML("beforeEnd",l.render(l.template.header,a))},updateNoteName:function(e){var t=c.call(l.eles.sessions,"[data-account="+e.target+"]")[0];t&&(c.call(t,".item-nick-name")[0].innerHTML=e.noteName);var n=c.call(l.eles.friends,"[data-account="+e.target+"]")[0];n&&(c.call(n,".item-single-row")[0].innerHTML=e.noteName)},updateGroupName:function(e){var t=c.call(l.eles.sessions,'[data-account="'+e.account+'"]')[0];t&&(c.call(t,".item-nick-name")[0].innerHTML=e.value);var n=c.call(l.eles.groups,'[data-account="'+e.account+'"]')[0];n&&(c.call(n,".item-single-row")[0].innerHTML=e.value)},updateTeamName:function(e){var t=c.call(l.eles.sessions,'[data-account="'+e.account+'"]')[0];t&&(c.call(t,".item-nick-name")[0].innerHTML=e.value);var n=c.call(l.eles.teams,'[data-account="'+e.account+'"]')[0];n&&(c.call(n,".item-single-row")[0].innerHTML=e.value)},updateGroup:function(e){var t=c.call(l.eles.sessions,'[data-account="'+e.account+'"]')[0];t&&(c.call(t,".item-nick-name")[0].innerHTML=e.account,c.call(t,"img")[0].src=a.defaultTeamAvatar)},updateSession:function(e){var t,n;e.to===a.account?(t=c.call(l.eles.sessions,'[data-account="'+e.from+'"]')[0],n=u(a.sessions,function(t){return t.account===e.from})):(t=c.call(l.eles.sessions,'[data-account="'+e.to+'"]')[0],n=u(a.sessions,function(t){return t.account===e.to})),t?(c.call(t,".item-last-msg")[0].innerHTML=e.content,c.call(t,".item-time")[0].innerHTML=s(e.time),n.messages.push(e),l.funcs.placeToTop(t)):(n={account:e.to===a.account?e.from:e.to,type:"number"==typeof e.to?"group":"p2p",updateTime:e.time,messages:[{content:e.content,from:e.from,time:e.time,type:e.type}]},a.sessions.push(n),l.exec("chatWindow-refreshContent",{content:n.messages}))},placeToTop:function(e){var t=e.parentNode;t.insertBefore(e,t.childNodes[0])},refreshNickName:function(){l.eles.nickName.innerHTML=a.nickName}},eventsMap:{"click .nav-tab":"switchTab","click .pencil":"showMyInfo","click #show-blacklist":"showBlacklist","click #add-friend":"showUserDialog","click #search-group":"showGroupDialog","click #show-notice":"showNotice","click .item":"clickItem","click #logout":"showLogoutDialog","click #create-group":"createGroup","click #create-team":"createTeam"},api:{"chatPanel-updateNoteName":"updateNoteName","chatPanel-updateGroupName":"updateGroupName","chatPanel-updateTeamName":"updateTeamName","chatPanel-updateGroup":"updateGroup","chatPanel-updateSession":"updateSession","chatPanel-refreshNickName":"refreshNickName"},eventer:n.eventer,init:function(){a=e.data,this.funcs.renderHeader(),l.sessions=a.sessions,l.friends=a.friends,l.groups=a.groups,l.teams=a.teams,l.eles.nickName=c("#nick-name")}});l.eventer.on("init",function(){"function"==typeof l.init&&l.init()})}(this,utils,app),function(e,t,n){"use strict";var a,i=utils.show,o=utils.hide,c=utils.q,s=utils.serializeTime,r=["angry","anguished","astonished","disappointed","blush","bowtie","cold_sweat","confounded","confused","cry","crying_cat_face","relieved","satisfied","relaxed","scream","scream_cat","see_no_evil","dizzy_face","expressionless","fearful","flushed","frowning","full_moon_with_face","grin","grinning","heart_eyes","heart_eyes_cat","hushed","innocent","joy","joy_cat","kissing","kissing_cat","kissing_heart","neutral_face","open_mouth","pensive","persevere","rage","pouting_cat","sleeping","sleepy","smile","kissing_smiling_eyes","laughing","mask","smile_cat","smiling_imp","smirk","smiley","smirk_cat","sob","stuck_out_tongue","weary","wink","worried","yum","sweat_smile","sweat","triumph","unamused","heart","heavy_exclamation_mark","stuck_out_tongue_closed_eyes","stuck_out_tongue_winking_eye","sun_with_face","sunglasses","tired_face","pill","v","point_up_2","point_up","point_down","point_left","point_right","poop","pray","raised_hands","tada","\\+1","-1","balloon","bicyclist","beer","bomb","bouquet","broken_heart","clap","crown","fire","ghost","gift","gift_heart"],u=new V({el:"#chat-window",eles:{avatar:"#chat-window-avatar",name:"#chat-window-name",cloudMsg:"#cloud-msg",groupInfo:"#group-info",content:".content 0",choseFile:".file 0",msgInput:".msg-input 0",emoji:".icon-emoji 0",mask:".chat-mask 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(u.el):o(u.el)}},type:{type:"string",init:"",callback:function(e){"p2p"===e?o(u.eles.groupInfo):i(u.eles.groupInfo)}},name:{type:"string",init:"null",callback:function(e){u.eles.name.innerHTML=e||"null"}},avatar:{type:"string",init:"",callback:function(e){u.eles.avatar.src=e!==u.type?e:"p2p"===u.type?a.defaultAvatar:"group"===u.type?a.defaultGroupAvatar:a.defaultTeamAvatar}},content:{type:"array",init:[],extend:{push:function(e){var t=this[this.length-1],n=0;(e.to===u.account||"p2p"===e.type&&e.from===u.account)&&(void 0===t?u.eles.content.innerHTML="":n=t.time,e.time-n>config.timeout&&u.eles.content.insertAdjacentHTML("beforeEnd",u.funcs.getMsgEle({type:"timeMsg",time:e.time})),u.eles.content.insertAdjacentHTML("beforeEnd",u.funcs.getMsgEle(e))),Array.prototype.push.call(this,e)}},callback:function(e){var t="",n=0,a=config.timeout;e.forEach(function(e,i){(0===i||e.time-n>a)&&(t+=u.funcs.getMsgEle({type:"timeMsg",time:e.time})),n=e.time,t+=u.funcs.getMsgEle(e)}),""===t&&(t+=u.funcs.getMsgEle({type:"systemMsg",content:"暂无消息"})),u.eles.content.innerHTML=t}}},template:{timeMsg:c("#time-msg-template").innerHTML,systemMsg:c("#system-msg-template").innerHTML,meMsg:c("#me-msg-template").innerHTML,othersGroupMsg:c("#others-group-msg-template").innerHTML,othersP2pMsg:c("#others-p2p-msg-template").innerHTML},funcs:{hide:function(){u.show=!1},show:function(e){void 0===e&&void 0===u.account||(u.funcs.refresh(e),u.show=!0,u.exec("groupInfo-hide"),u.exec("cloudMsg-hide"))},refresh:function(e){if("object"==typeof e&&u.account!==e.account){var t=n.funcs.find(e)||n.funcs.findGroupUser(e.account);u.type=e.type,u.account=e.account,t?(u.avatar=t.avatar||e.type,u.name="p2p"===e.type?t.noteName||t.nickName:t.name,o(u.eles.mask)):(u.avatar=a.defaultTeamAvatar,u.name=e.account+"",i(u.eles.mask));var c=n.funcs.findSession(e.account);u.content=c?c.messages:[]}},refreshContent:function(e){u.content=e.content},showCloudMsg:function(){"p2p"===u.type?u.exec("cloudMsg-fetch",{from:a.account,to:u.account}):u.exec("cloudMsg-fetch",{to:u.account})},showGroupInfo:function(){u.exec("groupInfo-show",{account:u.account,type:u.type})},showOthersInfo:function(){"p2p"===u.type?u.exec("othersInfo-show",{account:u.account}):u.exec("othersInfo-show",{account:this.getAttribute("data-account")})},openFile:function(){u.eles.choseFile.click()},sendMsg:function(){var e=u.eles.msgInput.value;if(0!=e){var t={type:u.type,from:a.account,to:u.account,time:(new Date).getTime(),content:e};n.funcs.sendMsg(t),u.eles.msgInput.value=""}},quickSendMsg:function(e){13===e.keyCode&&(u.funcs.sendMsg(),e.preventDefault())},getMsgEle:function(e){var t,i;switch(e.type){case"timeMsg":t=u.render(u.template.timeMsg,{time:s(e.time,!0)});break;case"systemMsg":t=u.render(u.template.systemMsg,e);break;case"p2p":e.from===a.account?t=u.render(u.template.meMsg,{avatar:a.avatar||a.defaultAvatar,content:e.content}):(i=n.funcs.findFriend(e.from)||n.funcs.findGroupUser(e.from),t=u.render(u.template.othersP2pMsg,{avatar:i.avatar||a.defaultAvatar,content:e.content}));break;case"group":e.from===a.account?t=u.render(u.template.meMsg,{avatar:a.avatar||a.defaultAvatar,content:e.content}):(i=n.funcs.findGroupUser(e.from),t=u.render(u.template.othersGroupMsg,{name:i.noteName||i.nickName,avatar:i.avatar||a.defaultAvatar,content:e.content,account:e.from}))}return t=t.replace(/\[(\w+)\]/g,function(e,t){var n;return r.some(function(e){if(e===t)return n=!0}),1==n?'<i data-des="'+t+'"class="emoji emoji_'+t+'"></i>':"["+t+"]"})},onRemoveGroup:function(e){e.account===u.account&&(u.account=null,u.funcs.hide())}},eventsMap:{"click #cloud-msg":"showCloudMsg","click #group-info":"showGroupInfo","click [data-operate=showOthersInfo]":"showOthersInfo","click .icon-file":"openFile","click .send":"sendMsg","keydown .msg-input":"quickSendMsg"},api:{"chatWindow-show":"show","chatWindow-hide":"hide","chatWindow-onRemoveGroup":"onRemoveGroup","chatWindow-refreshContent":"refreshContent"},eventer:n.eventer,init:function(){a=e.data,n.funcs.getMsgEle=u.funcs.getMsgEle,new Emoji({array:r,input:this.eles.msgInput,emojiButton:this.eles.emoji}).init()}});u.eventer.on("init",function(){"function"==typeof u.init&&u.init()})}(this,utils,app),function(e,t,n){"use strict";var a=(n.mask,utils.show),i=utils.hide,o=new V({el:"#cloud-msg-container",eles:{content:".content 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?a(o.el):i(o.el)}},content:{type:"array",init:[],extend:{push:function(e){var t=this.slice(-1)[0].time;e.time-t>config.timeout&&o.eles.content.insertAdjacentHTML("beforeEnd",n.funcs.getMsgEle({type:"timeMsg",time:e.time})),o.eles.content.insertAdjacentHTML("beforeEnd",n.funcs.getMsgEle(e)),Array.prototype.push.call(this,e)}},callback:function(e){var t="",a=0,i=config.timeout;e.forEach(function(e,o){(0===o||e.time-a>i)&&(t+=n.funcs.getMsgEle({type:"timeMsg",time:e.time})),a=e.time,t+=n.funcs.getMsgEle(e)}),""===t&&(t+=n.funcs.getMsgEle({type:"systemMsg",content:"暂无消息"})),o.eles.content.innerHTML=t}}},funcs:{hide:function(){o.show=!1},show:function(){o.show=!0,o.exec("chatWindow-hide")},fetch:function(e){n.funcs.getCloudMsg(e)},refresh:function(e){o.content=e,o.funcs.show()},showChatWindow:function(){o.exec("chatWindow-show")}},eventsMap:{"click .close":"showChatWindow"},api:{"cloudMsg-show":"show","cloudMsg-hide":"hide","cloudMsg-fetch":"fetch","cloudMsg-refresh":"refresh"},eventer:n.eventer})}(0,utils,app),function(e,t,n){"use strict";var a=n.mask,i=utils.show,o=utils.hide,c=utils.q,s=utils.hasClass,r=utils.addClass,u=utils.removeClass,l=new V({el:"#create-group-container",eles:{count:"#add-user-count",addedList:"#added-list",userList:".user-list 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(l.el):o(l.el)}},count:{type:"number",init:0,callback:function(e){l.eles.count.innerHTML=e}},userList:{type:"array",init:[],callback:function(e){var t=[];e.forEach(function(e){t.push(l.render(l.template.add,e))}),l.eles.userList.innerHTML=t.join("")}},added:{type:"array",init:[],extend:{push:function(e){var t={};l.userList.some(function(n){if(n.account===e)return t=n,!0}),l.eles.addedList.insertAdjacentHTML("beforeEnd",l.render(l.template.added,t)),l.count++,Array.prototype.push.call(this,e)},remove:function(e){var t=c.call(l.eles.addedList,"[data-account="+e+"]")[0];l.eles.addedList.removeChild(t),l.count--;var n=utils.findIndex(this,e);Array.prototype.splice.call(this,n,1)}},callback:function(e){var t=[],n=0;e.forEach(function(e){n++,t.push(l.render(l.template.added,e))}),l.count=n,l.eles.addedList.innerHTML=t.join("")}}},template:{add:c("#create-group-add-template").innerHTML,added:c("#create-group-added-template").innerHTML},funcs:{hide:function(){a.show=l.show=!1},show:function(e){void 0!==e&&(l.operate=e.operate||"add",l.type=e.type||"group",l.account=e.account,l.funcs.refresh(),a.show=l.show=!0)},refresh:function(){var e=[];if("add"===l.operate){var t="group"===l.type?n.funcs.findGroup(l.account):n.funcs.findTeam(l.account);null!==t&&(e=t.members)}l.added=[],l.userList=data.friends.map(function(t){var n=!1;return e.some(function(e){if(t.account===e)return n=!0}),{avatar:t.avatar||data.defaultAvatar,name:t.noteName||t.nickName,account:t.account,status:n?"cur2":""}})},addUser:function(){if(!s(this,"cur2")){var e=this.parentNode.getAttribute("data-account");s(this,"cur")?(u(this,"cur"),l.added.remove(e)):(r(this,"cur"),l.added.push(e))}},add:function(){"add"===l.operate?"group"===l.type?n.funcs.addGroupMember(l.account,[].concat(l.added)):n.funcs.addTeamMember(l.account,[].concat(l.added)):"group"===l.type?n.funcs.createGroup(data.account,[data.account].concat(l.added)):n.funcs.createTeam(data.account,[data.account].concat(l.added)),l.funcs.hide()}},eventsMap:{"click .icon-close":"hide","click .close":"hide","click .icon-radio":"addUser","click .add":"add"},api:{"createGroup-show":"show","createGroup-hide":"hide"},eventer:n.eventer})}(0,utils,app),function(e,t){"use strict";function n(e){this.array=e.array,this.input=e.input,this.emojiButton=e.emojiButton,this.containerStyle=e.containerStyle||{position:"absolute",top:"-270px",left:"39px",width:"500px",height:"300px","z-index":"100",background:"#ffffff",border:"1px solid #ccc","box-sizing":"content-box"}}var a=t.on;t.q;n.prototype={init:function(){this.loadEmoji(),this.bindEvent()},bindEvent:function(){var e=this;a(this.emojiContainer,"click",".emojiContainer",function(t){var n=this.children[0].getAttribute("data-des");e.input.value+="["+n+"]",t.stopPropagation()}),a(e.emojiButton,"click",function(t){e.emojiContainer.style.display="block"===e.emojiContainer.style.display?"none":"block",t.stopPropagation()}),a(document,"click",function(t){e.emojiContainer.style.display="none"})},loadEmoji:function(){var e,t,n=[],a=this.array,i="display:none;",o=a.length;for(this.emojiContainer=document.createElement("div"),e=0;e<o;e++)n.push('<span class="emojiContainer"><i data-des="'+a[e]+'"class="emoji emoji_'+a[e]+'"></i></span>');for(t in this.containerStyle)i+=t+":"+this.containerStyle[t]+";";this.emojiContainer.innerHTML='<div style="overflow:auto;width:'+(this.containerStyle.width||0)+";height:"+(this.containerStyle.height||0)+';">'+n.join("")+"</div>",this.emojiContainer.setAttribute("id","emojiContainer"),this.emojiContainer.setAttribute("style",i),this.emojiButton.parentNode.appendChild(this.emojiContainer)}},e.Emoji=n}(this,utils),function(e,t,n){"use strict";var a=n.mask,i=utils.show,o=utils.hide,c=(utils.find,new V({el:"#group-dialog",eles:{search:"[name=search] 0",info:".info 0",avatar:".avatar 0",groupName:".group-name 0",account:".account 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(c.el):o(c.el)}},avatar:{type:"string",init:"",callback:function(e){c.eles.avatar.src=e}},account:{type:"string",init:"",callback:function(e){c.eles.account.innerHTML=e}},groupName:{type:"string",init:"",callback:function(e){c.eles.groupName.innerHTML=e}}},funcs:{hide:function(){a.show=c.show=!1},show:function(){a.show=c.show=!0},searchGroup:function(){var e=c.eles.search.value;if(!c.funcs.isNumber(e))return alert("群id必须是数字");e=parseInt(e);var t=n.funcs.findGroup(e),a="group";t||(t=n.funcs.findTeam(e),a="team"),t?c.funcs.refresh({success:!0,data:{account:t.account,groupName:t.name,avatar:t.avatar||"group"===a?data.defaultGroupAvatar:data.defaultTeamAvatar,relation:"friend"}}):n.client.emit("searchGroup",{account:e})},refresh:function(e){e.success?(c.el.className="dialog "+e.data.relation,c.groupName=e.data.groupName,c.account=e.data.account+"",c.avatar=e.data.avatar):c.el.className="dialog done"},returnSearch:function(){c.el.className="dialog",c.eles.search.value=""},close:function(){c.funcs.returnSearch(),c.funcs.hide()},isNumber:function(e){return/^\+?[1-9][0-9]*$/.test(e)},openChatWindow:function(){c.funcs.hide(),c.exec("chatWindow-show",{type:"group",account:c.account})}},eventsMap:{"click .close":"close","click .done":"close","click .search":"searchGroup","click .back":"returnSearch","click .chat":"openChatWindow"},api:{"groupDialog-show":"show","groupDialog-hide":"close","groupDialog-refresh":"refresh"},eventer:n.eventer}))}(0,utils,app),function(e,t,n){"use strict";var a=utils.show,i=utils.hide,o=utils.q,c=utils.remove,s=new V({el:"#group-info-container",eles:{memberList:"#group-member-list",nameCtn:".group-name-ctn 0",name:".group-name 0",nameInput:"#group-name-input",infoCtn:".group-info-ctn 0",info:".group-info 0",infoInput:"#group-info-input",radios:"[type=radio]",radio0:"[name=radio-0]",radio1:"[name=radio-1]",radio2:"[name=radio-2]",radio3:"[name=radio-3]",avatar:".avatar 0",account:".account 0",items:".item",btnCtn:".btns 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?a(s.el):i(s.el)}},list:{type:"array",init:[],extend:{push:function(e){if(this===s.funcs.getCurrentMember()){var t,a=n.funcs.findFriend(e)||n.funcs.getMemberInfo(e),i={};i.name=a.noteName||a.nickName,i.account=e,i.avatar=a.avatar||data.defaultAvatar,t=s.owner===data.account?s.render(s.template.ownerMember,i):s.render(s.template.member,i),s.eles.memberList.insertAdjacentHTML("beforeEnd",t),Array.prototype.push.call(this,e)}},remove:function(e){if(this===s.funcs.getCurrentMember()){if(e!==data.account){var t=o.call(s.eles.memberList,"[data-account="+e+"]")[0];s.eles.memberList.removeChild(t)}c(this,e)}}},callback:function(e){if(e===s.funcs.getCurrentMember()){var t=[];s.invite?t.push(s.template.plus):"team"===s.type&&t.push(s.template.plus),e.forEach(function(e){var a=n.funcs.findFriend(e)||n.funcs.getMemberInfo(e),i={};return i.name=a.noteName||a.nickName,i.account=e,i.avatar=a.avatar||data.defaultAvatar,s.owner===e?t.push(s.render(s.template.owner,i)):s.owner===data.account?t.push(s.render(s.template.ownerMember,i)):void t.push(s.render(s.template.member,i))}),s.eles.memberList.innerHTML=t.join("")}}},name:{type:"string",init:"",callback:function(e){s.eles.name.innerHTML=e,s.eles.nameInput.value!==e&&(s.eles.nameInput.value=e)}},account:{type:"number",init:0,callback:function(e){s.eles.account.innerHTML=e}},type:{type:"string",init:"group",callback:function(e){"group"===e?utils.removeClass(s.el,"team"):utils.addClass(s.el,"team")}},info:{type:"string",init:"",callback:function(e){s.eles.info.innerHTML=e,s.eles.infoInput.value!==e&&(s.eles.infoInput.value=e)}},avatar:{type:"string",init:"",callback:function(e){s.eles.avatar.src=e}}},template:{plus:o("#group-info-plus-template").innerHTML,owner:o("#group-info-owner-template").innerHTML,ownerMember:o("#group-info-owner-member-template").innerHTML,member:o("#group-info-member-template").innerHTML},funcs:{hide:function(){s.show=!1},show:function(e){void 0!==e&&s.funcs.refresh(e),s.show=!0,s.exec("chatWindow-hide")},refresh:function(e){if(e.account!==s.account){var t;if("group"===e.type)t=n.funcs.findGroup(e.account);else{if("team"!==e.type)return console.error("the type is not exist");t=n.funcs.findTeam(e.account)}if(null===t)return console.error("the group is not exist");s.account=e.account,s.type=e.type,s.avatar=t.avatar||"group"===s.type?data.defaultGroupAvatar:data.defaultTeamAvatar;var a=t.permissions||{verify:1,invite:0,modify:0,verifyed:0},i=t.owner===data.account;s.owner=t.owner,s.invite=1===a.invite||i,s.modify=1===a.modify||i,s.list=t.members,this.refreshFooter(i),s.name=t.name||"",s.info=t.des||""}},refreshFooter:function(e){if("group"===s.type){var t=n.funcs.findGroup(s.account).permissions
;!1===e?([].forEach.call(s.eles.radios,function(e){e.disabled=!0}),1!==s.modify&&(utils.removeClass(s.eles.nameInput.parentNode.children[0],"owner"),utils.removeClass(s.eles.infoInput.parentNode.children[0],"owner")),i(s.eles.btnCtn.children[1]),a(s.eles.btnCtn.children[0]),s.eles.btnCtn.children[0].innerHTML="退出该群"):([].forEach.call(s.eles.radios,function(e){e.disabled=!1}),utils.addClass(s.eles.nameInput.parentNode.children[0],"owner"),utils.addClass(s.eles.infoInput.parentNode.children[0],"owner"),i(s.eles.btnCtn.children[0]),a(s.eles.btnCtn.children[1])),[].forEach.call(s.eles.items,function(e,t){t>1&&a(e)}),[].forEach.call(s.eles.radio0,function(e){e.value==t.verify&&(e.checked=!0)}),[].forEach.call(s.eles.radio1,function(e){e.value==t.invite&&(e.checked=!0)}),[].forEach.call(s.eles.radio2,function(e){e.value==t.modify&&(e.checked=!0)}),[].forEach.call(s.eles.radio3,function(e){e.value==t.verifyed&&(e.checked=!0)})}else e&&utils.addClass(s.eles.nameInput.parentNode.children[0],"owner"),[].forEach.call(s.eles.items,function(e,t){t>1&&i(e)}),i(s.eles.btnCtn.children[1]),a(s.eles.btnCtn.children[0]),s.eles.btnCtn.children[0].innerHTML="退出讨论组"},showChatWindow:function(){s.exec("chatWindow-show")},addUser:function(){s.exec("createGroup-show",{operate:"add",type:s.type,account:s.account})},getCurrentMember:function(){return n.funcs.find({type:s.type,account:s.account}).members||[]},remove:function(){var e=this.getAttribute("data-account");e!==data.account&&("group"===s.type?n.funcs.removeGroupMember(s.account,[e]):n.funcs.removeTeamMember(s.account,[e]))},editName:function(){s.modify&&(utils.addClass(s.eles.nameCtn,"edit"),s.eles.nameInput.focus())},editInfo:function(){s.modify&&(utils.addClass(s.eles.infoCtn,"edit"),s.eles.infoInput.focus())},showName:function(){utils.removeClass(s.eles.nameCtn,"edit"),s.name!==this.value&&(s.name=this.value,"group"===s.type?n.funcs.updateGroupName({account:s.account,value:s.name}):n.funcs.updateTeamName({account:s.account,value:s.name}))},showInfo:function(){utils.removeClass(s.eles.infoCtn,"edit"),s.info!==this.value&&(s.info=this.value,n.funcs.updateGroupDes({account:s.account,value:s.info}))},existGroup:function(){("group"===s.type?confirm("确定要退出该群？"):confirm("确定要退出讨论组？"))&&("group"===s.type?n.funcs.existGroup(s.account):n.funcs.existTeam(s.account))},dissolveGroup:function(){confirm("确定要解散该群？")&&n.funcs.dissolveGroup(s.account)},onRemoveGroup:function(e){e.account===s.account&&s.funcs.hide()},updateAuthentication:function(){n.funcs.updateAuthentication({account:s.account,value:parseInt(this.value)})},updateInvitePermissions:function(){n.funcs.updateInvitePermissions({account:s.account,value:parseInt(this.value)})},updateModifyPermissions:function(){n.funcs.updateModifyPermissions({account:s.account,value:parseInt(this.value)})},updateBeAuthentication:function(){n.funcs.updateBeAuthentication({account:s.account,value:parseInt(this.value)})}},eventsMap:{"click .close":"showChatWindow","click .add-item":"addUser","click .edit-name":"editName","click .edit-info":"editInfo","click .exist-group":"existGroup","click .dissolve-group":"dissolveGroup","click [data-account]":"remove","click [name=radio-0]":"updateAuthentication","click [name=radio-1]":"updateInvitePermissions","click [name=radio-2]":"updateModifyPermissions","click [name=radio-3]":"updateBeAuthentication","focusout #group-name-input":"showName","focusout #group-info-input":"showInfo"},api:{"groupInfo-show":"show","groupInfo-hide":"hide","groupInfo-onRemoveGroup":"onRemoveGroup"},eventer:n.eventer})}(0,utils,app),function(e,t,n){"use strict";var a=n.mask,i=utils.show,o=utils.hide,c=new V({el:"#logout-dialog",eles:{},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(c.el):o(c.el)}}},funcs:{hide:function(){a.show=c.show=!1},show:function(){a.show=c.show=!0},logout:function(){}},eventsMap:{"click .close":"hide","click .logout":"logout"},api:{"logoutDialog-show":"show","logoutDialog-hide":"hide"},eventer:n.eventer})}(0,utils,app),function(e,t,n){"use strict";var a=n.mask,i=utils.show,o=utils.hide,c=new V({el:"#modify-avatar-card",eles:{choseAvatar:"#chose-avatar",avatars:"img",choseFileContainer:".chose-file-container 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(c.el):o(c.el),i(c.eles.choseFileContainer),[].forEach.call(c.eles.avatars,function(e){o(e),e.src=""})}},src:{type:"string",init:"",callback:function(e){o(c.eles.choseFileContainer),[].forEach.call(c.eles.avatars,function(t){i(t),t.src=e})}}},funcs:{hide:function(){a.show=c.show=!1,c.exec("myInfo-show")},show:function(){c.exec("myInfo-hide"),a.show=c.show=!0},choseAvatar:function(){c.eles.choseAvatar.click()},changeAvatar:function(){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return void alert("The File APIs are not fully supported in this browser.");if(void 0!==this.files[0]){var e=new FileReader;e.onload=function(e){c.src=e.target.result},e.readAsDataURL(this.files[0])}}},eventsMap:{"click .close":"hide","click .chose-avatar":"choseAvatar","change #chose-avatar":"changeAvatar"},api:{"modifyAvatar-show":"show","modifyAvatar-hide":"hide"},eventer:n.eventer})}(0,utils,app),function(e,t,n){"use strict";var a=n.mask,i=utils.show,o=utils.hide,c=utils.camel,s=(utils.q,utils.assign),r={},u=new V({el:"#my-info",eles:{userInfo:".user-info 0",choseAvatar:"#chose-avatar",gender:".gender 0",genderInput:"[data-des=gender] 0",nickName:".nick-name 0",nickNameInput:"[data-des=nick-name] 0",birthday:".u-birthday 0",birthdayInput:"[data-des=birthday] 0",email:".u-email 0",emailInput:"[data-des=email] 0",tel:".u-tel 0",telInput:"[data-des=tel] 0",sign:".u-sign 0",signInput:"[data-des=sign] 0",account:".account 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(u.el):o(u.el)}},edit:{type:"boolean",init:!1,callback:function(e){e?utils.addClass(u.eles.userInfo,"edit"):utils.removeClass(u.eles.userInfo,"edit")}},account:{type:"string",init:"",callback:function(e){u.eles.account.innerHTML="账号："+e}},gender:{type:"string",init:"",callback:function(e){u.eles.gender.className=e?"gender "+e:"gender",u.eles.genderInput.value=e}},nickName:{type:"string",init:"",callback:function(e){u.eles.nickName.innerHTML=e||"--",u.eles.nickNameInput.value=e}},birthday:{type:"string",init:"",callback:function(e){u.eles.birthday.innerHTML=e||"--",u.eles.birthdayInput.value=e}},email:{type:"string",init:"",callback:function(e){u.eles.email.innerHTML=e||"--",u.eles.emailInput.value=e}},tel:{type:"string",init:"",callback:function(e){u.eles.tel.innerHTML=e||"--",u.eles.telInput.value=e}},sign:{type:"string",init:"",callback:function(e){u.eles.sign.innerHTML=e||"--",u.eles.signInput.value=e}}},funcs:{hide:function(){a.show=u.show=!1},show:function(){a.show=u.show=!0,u.funcs.refresh()},modifyAvatar:function(){u.exec("modifyAvatar-show")},storageInfo:function(){var e=c(this.getAttribute("data-des"));r[e]=this.value},clearInfo:function(){r={}},updateInfo:function(){s(u,r),n.funcs.updateUserInfo({account:data.account,info:r})},operate:function(){var e=this.classList[1];u.edit=!u.edit,"operate-cancel"===e?u.funcs.clearInfo():"operate-save"===e&&u.funcs.updateInfo()},refresh:function(){u.account=data.account||"",u.nickName=data.nickName||"",u.gender=data.gender||"",u.birthday=data.birthday||"",u.tel=data.tel||"",u.email=data.email||"",u.sign=data.sign||""}},eventsMap:{"click .close":"hide","click #modify-avatar":"modifyAvatar","change [data-des]":"storageInfo","click .operate-btn":"operate"},api:{"myInfo-show":"show","myInfo-hide":"hide"},eventer:n.eventer})}(0,utils,app),function(e,t,n){"use strict";var a=n.mask,i=utils.show,o=utils.hide,c=utils.q,s=utils.serializeTime,r=new V({el:"#notice",eles:{tabs:".tab",contents:".content",systemNotice:"#system-notice",customNotice:"#custom-notice"},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(r.el):o(r.el)}},active:{type:"string",init:"system-notice",callback:function(e){[].forEach.call(r.eles.tabs,function(t){t.getAttribute("data-notice")===e?utils.addClass(t,"active"):utils.removeClass(t,"active")}),[].forEach.call(r.eles.contents,function(t){t.id===e?i(t):o(t)})}},systemNotice:{type:"array",init:[],extend:{push:function(e){var t={name:e.name,time:s(e.time,"hh:mm"),content:e.content};t.avatar=e.avatar||"p2p"===e.type?data.defaultAvatar:"group"===e.type?data.defaultGroupAvatar:data.defaultTeamAvatar,r.eles.systemNotice.insertAdjacentHTML("afterBegin",r.render(r.template.systemNoticeItem,t)),Array.prototype.push.call(this,e)}},callback:function(e){var t="";e.forEach(function(e){var n={name:e.name,time:s(e.time,"hh:mm"),content:e.content};n.avatar=e.avatar||"p2p"===e.type?data.defaultAvatar:"group"===e.type?data.defaultGroupAvatar:data.defaultTeamAvatar,t+=r.render(r.template.systemNoticeItem,n)}),r.eles.systemNotice.innerHTML=t}},customNotice:{type:"array",init:[],extend:{push:function(e){var t={name:e.name,time:s(e.time,"hh:mm"),content:e.content};t.avatar=e.avatar||"p2p"===e.type?data.defaultAvatar:"group"===e.type?data.defaultGroupAvatar:data.defaultTeamAvatar,r.eles.systemNotice.insertAdjacentHTML("afterBegin",r.render(r.template.systemNoticeItem,t)),Array.prototype.push.call(this,e)}},callback:function(e){var t="";e.forEach(function(e){var n={name:e.name,time:s(e.time,"hh:mm"),content:e.content};n.avatar=e.avatar||"p2p"===e.type?data.defaultAvatar:"group"===e.type?data.defaultGroupAvatar:data.defaultTeamAvatar,t+=r.render(r.template.customNoticeItem,n)}),r.eles.customNotice.innerHTML=t}}},template:{systemNoticeItem:c("#notice-system-item-template").innerHTML,customNoticeItem:c("#notice-custom-item-template").innerHTML},funcs:{hide:function(){a.show=r.show=!1},show:function(){a.show=r.show=!0},switchActive:function(){r.active=this.getAttribute("data-notice")},clear:function(){"system-notice"===r.active?r.systemNotice=[]:r.customNotice=[]},operate:function(){this.parentNode.innerHTML="已"+this.getAttribute("data-operate")}},eventsMap:{"click .icon-close":"hide","click [data-notice]":"switchActive","click .trash":"clear","click .operate":"operate"},api:{"notice-show":"show","notice-hide":"hide"},eventer:n.eventer});r.eventer.on("init",function(){r.systemNotice.push({name:"user1、user2等人",avatar:null,content:"233邀请你入群",type:"group",time:new Date})})}(0,utils,app),function(e,t,n){"use strict";var a=n.mask,i=utils.show,o=utils.hide,c=utils.addClass,s=utils.removeClass,r=new V({el:"#others-info",eles:{avatar:".avatar 0",name:".nick-name 0",gender:".gender 0",account:".u-account 0",nickName:".u-nickName 0",noteName:".note 0",birthday:".u-birthday 0",tel:".u-tel 0",email:".u-email 0",sign:".u-sign 0",blacklist:".blacklist 0",mutelist:".mutelist 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(r.el):o(r.el)}},blacklist:{type:"boolean",init:!1,callback:function(e){e?utils.removeClass(r.eles.blacklist,"off"):utils.addClass(r.eles.blacklist,"off")}},mutelist:{type:"boolean",init:!1,callback:function(e){e?utils.removeClass(r.eles.mutelist,"off"):utils.addClass(r.eles.mutelist,"off")}},avatar:{type:"string",init:"",callback:function(e){r.eles.avatar.src=e||data.defaultAvatar}},gender:{type:"string",init:"",callback:function(e){r.eles.gender.className=e?"gender "+e:"gender"}},name:{type:"string",init:"",callback:function(e){r.eles.name.innerHTML=e}},account:{type:"string",init:"",callback:function(e){r.eles.account.innerHTML="账号："+e}},nickName:{type:"string",init:"",callback:function(e){r.eles.nickName.innerHTML="昵称："+e}},noteName:{type:"string",init:"",callback:function(e){r.eles.noteName.value=e||""}},birthday:{type:"string",init:"",callback:function(e){r.eles.birthday.innerHTML=e||"--"}},email:{type:"string",init:"",callback:function(e){r.eles.email.innerHTML=e||"--"}},tel:{type:"string",init:"",callback:function(e){r.eles.tel.innerHTML=e||"--"}},sign:{type:"string",init:"",callback:function(e){r.eles.sign.innerHTML=e||"--"}}},funcs:{hide:function(){a.show=r.show=!1},show:function(e){if(a.show=r.show=!0,void 0!==e){var t=n.funcs.findFriend(e.account);t?s(r.el,"no-friend"):(c(r.el,"no-friend"),t=n.funcs.findGroupUser(e.account)),t?r.funcs.refresh(t):n.client.emit("othersInfo-getUser",e.account)}},refresh:function(e){for(var t in r)"string"==typeof r[t]&&(r[t]="");for(t in e)r[t]=e[t]||"";r.name=e.noteName||e.nickName,r.blacklist=n.funcs.isBlacklist(r.account)},addFriend:function(){n.funcs.addFriend(r.account),r.funcs.hide()},deleteFriend:function(){confirm("确定要删除")&&(n.funcs.deleteFriend(r.account),r.funcs.hide())},updateNoteName:function(){var e=r.eles.noteName.value;r.noteName!==e&&(r.noteName=e,n.funcs.updateNoteName(data.account,r.account,e))},refreshNoteName:function(){r.name=r.noteName},toggleBlacklist:function(){r.blacklist=!r.blacklist,r.blacklist?r.exec("blacklist-add",r.account):r.exec("blacklist-remove",r.account)},toggleMutelist:function(){r.mutelist=!r.mutelist},openChatWindow:function(){r.exec("othersInfo-hide"),r.exec("chatWindow-show",{type:"p2p",account:r.account})}},eventsMap:{"click .close":"hide","click .toggle-blacklist":"toggleBlacklist","click .toggle-mutelist":"toggleMutelist","click .chat":"openChatWindow","click .del":"deleteFriend","click .add":"addFriend","click .save":"updateNoteName"},api:{"othersInfo-show":"show","othersInfo-hide":"hide","othersInfo-refresh":"refresh","othersInfo-refreshNoteName":"refreshNoteName"},eventer:n.eventer})}(0,utils,app),function(e,t,n){"use strict";var a=n.mask,i=utils.show,o=utils.hide,c=new V({el:"#user-dialog",eles:{search:"[name=search] 0",info:".info 0",avatar:".avatar 0",nickName:".nick-name 0",account:".account 0",tip:".tip 0"},data:{show:{type:"boolean",init:!1,callback:function(e){e?i(c.el):o(c.el)}},avatar:{type:"string",init:"",callback:function(e){c.eles.avatar.src=e}},account:{type:"string",init:"",callback:function(e){c.eles.account.innerHTML=e}},nickName:{type:"string",init:"",callback:function(e){c.eles.nickName.innerHTML=e}}},funcs:{hide:function(){a.show=c.show=!1},show:function(){a.show=c.show=!0},searchUser:function(){var e,t=c.eles.search.value;return t===data.account?c.funcs.refresh({success:!1,msg:"别看了，就是你自己"}):(e=n.funcs.getBlacklistMemberInfo(t))?c.funcs.refresh({success:!0,data:{account:e.account,nickName:e.nickName,avatar:e.avatar||data.defaultAvatar,relation:"blacklist"}}):void((e=n.funcs.findFriend(t))?c.funcs.refresh({success:!0,data:{account:e.account,nickName:e.nickName,avatar:e.avatar||data.defaultAvatar,relation:"friend"}}):n.client.emit("searchUser",{account:t}))},add:function(){n.funcs.addFriend(c.account),c.funcs.close()},refresh:function(e){e.success?(c.el.className="dialog "+e.data.relation,c.nickName=e.data.nickName,c.account=e.data.account+"",c.avatar=e.data.avatar):(c.el.className="dialog done",c.eles.tip.innerHTML=e.msg)},close:function(){c.funcs.returnSearch(),c.funcs.hide()},returnSearch:function(){c.el.className="dialog",c.eles.search.value=""},openChatWindow:function(){c.funcs.hide(),c.exec("chatWindow-show",{type:"p2p",account:c.account})},removeBlacklist:function(){n.funcs.removeBlacklist(c.account),c.funcs.close()}},eventsMap:{"click .close":"close","click .done":"close","click .search":"searchUser","click .back":"returnSearch","click .chat":"openChatWindow","click .add":"add","click .remove-blacklist":"removeBlacklist"},api:{"userDialog-show":"show","userDialog-hide":"close","userDialog-refresh":"refresh"},eventer:n.eventer})}(0,utils,app);